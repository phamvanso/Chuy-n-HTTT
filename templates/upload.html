<!DOCTYPE html>
<html lang="vi-VN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>Tải lên tập tin</title>
</head>
<body>
    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}" style="background-color: {% if category == 'error' %}#f8d7da{% else %}#d4edda{% endif %}; color: {% if category == 'error' %}#721c24{% else %}#155724{% endif %}; padding: 12px 20px; margin: 10px auto; max-width: 600px; border-radius: 8px; text-align: center; font-weight: 500;">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="container">
            <h1>Tạo câu hỏi trắc nghiệm</h1>
            <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
                    <div class="cardupload">
                        <h3>Tải lên tập tin</h3>
                        <div class="drop_box">
                        <header>
                            <h4>Chọn tập tin tại đây</h4>
                        </header>
                        <p>Định dạng tập tin hỗ trợ: PDF, TXT, DOCX</p>
                        <p>Dung lượng tối đa: 50MB</p>
                        <input type="file" name="pdf_file" accept=".pdf,.txt,.docx" id="fileID" required>
                        <p id="fileSizeText"></p>
                        <p>Chọn số lượng câu hỏi muốn tạo?</p>
                        <input type="number" name="num_questions" value="5" min="1" max="100" required>
                        </div>
                        <div class="ans-btn-container">
                            <a href="/" class="btn-back">Quay lại</a>
                            <button class="btn-upload" type="submit">Tải lên</button>
                        </div>
                        
                    </div>
            </form>
        </div>
        <div class="loader-container" id="loaderContainer">
            <div class="loader"></div>
        </div>
    </main>
    <script>
        const fileInput = document.getElementById('fileID');
        const fileSizeText = document.getElementById('fileSizeText');

        function formatBytes(bytes) {
            if (!bytes) return '';
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)), 10);
            if (i === 0) return bytes + ' ' + sizes[i];
            return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
        }

        fileInput.addEventListener('change', function(event) {
            const file = event.target.files && event.target.files[0];
            if (!file) {
                fileSizeText.textContent = '';
                return;
            }
            fileSizeText.textContent = 'Dung lượng tệp đã chọn: ' + formatBytes(file.size);
        });

        document.getElementById('uploadForm').addEventListener('submit', function(event) {
            event.preventDefault(); 
            document.getElementById('loaderContainer').style.display = 'flex';
            
            setTimeout(function() {
                document.getElementById('uploadForm').submit(); 
            }, 1000); 
        });
    </script>

        
</body>
</html>